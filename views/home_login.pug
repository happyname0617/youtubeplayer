head
  // Latest compiled and minified CSS
  link(rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css', integrity='sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u', crossorigin='anonymous')
  // Optional theme
  link(rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css', integrity='sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp', crossorigin='anonymous')
  // Latest compiled and minified JavaScript
  script(src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js', integrity='sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa', crossorigin='anonymous')
body
  nav.navbar.navbar-inverse
    .container
      .navbar-header
        button.navbar-toggle.collapsed(type='button', data-toggle='collapse', data-target='#navbar', aria-expanded='false', aria-controls='navbar')
          span.sr-only Toggle navigation
          span.icon-bar
          span.icon-bar
          span.icon-bar
        a.navbar-brand(href='/') TypingTube.com alpha 
      #navbar.navbar-collapse.collapse
        ul.nav.navbar-nav.navbar-right
          li.active
            a(href='/') Home
          li
            a(href='#feed') Feed
          li
            a(href='#class') Class
          li
            a(href='#forum') Forum
          li
            a(href='#about') About
          li
            a(href='#mypage') MyPage
  .container.theme-showcase(role='main')
    .row
      .col-md-12
        .jumbotron
          h2 Youtube player for dictation practice
          h4 Enter your youtube url which have at least a caption
          input#youtubeurl(name='url', type='text', style='width:80%;',placeholder='https://www.youtube.com/watch?v=41rhm6Agvqs')
          #VideoInfo
          form.form-inline(action='/newvideo', method='post')
            input#youtubeID(name='youtubeVideoId', type='hidden')
            #VideoCaptions
            button.btn.btn-default(type='submit') Submit
        table.table.table-stripetable.table.table-striped.table-hover
          thead
            tr
              th
                | Video Title
              th
                | Language
              th
                | Progress
              th
                | Menu
          tbody
            each video in videolist
              tr
                td 
                  a(href='/play/'+video._id) #{video.videoTitle}
                td
                  | #{video.videoCaptionLangCode}
                td
                  | #{video.currentIndex}/#{video.caption.length}
                td
                  a(href='/delete/'+video._id) delete



  script(src='https://code.jquery.com/jquery-3.2.1.min.js', integrity='sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=', crossorigin='anonymous')
  script.
    function getVideoCaption(youtubeVideoId, callback)
    {
        //get video caption language list
        var url_lang = "/get/lang/"+youtubeVideoId;
        console.log(url_lang);
        $.getJSON( url_lang, function( caption ) {
          callback(caption);
        });
  
    }
    function getVideoInfo(youtubeVideoId,callback)
    {
        //get video info
        var url_vinfo = "/get/videoInfo/"+youtubeVideoId;
        //console.log(url_vinfo);
        $.getJSON( url_vinfo, function( vInfo ) {
          callback(vInfo)
        });    
    }
  
    $(document).ready(function(){

      $('#youtubeurl').on('paste',function(){
        setTimeout(function () {
        var youtubeVideoId = $('#youtubeurl').val().split("v=")[1]
        console.log(youtubeVideoId);
        getVideoInfo(youtubeVideoId,function(vInfo){
          console.log(vInfo);
          var title = vInfo.items[0].snippet.title;
          var description = vInfo.items[0].snippet.description;
          var thumbnailUrl = vInfo.items[0].snippet.thumbnails.default.url
          var thumbWidth = vInfo.items[0].snippet.thumbnails.default.width
          var thumbHeight = vInfo.items[0].snippet.thumbnails.default.height;
          var defaultAudioLanguage = vInfo.items[0].snippet.defaultAudioLanguage;
          $('#VideoInfo').html(`<img src='${thumbnailUrl}' width=${thumbWidth} height=${thumbHeight}><span>${title}</span>`);

          getVideoCaption(youtubeVideoId,function(caption){
            console.log(JSON.stringify(caption));
            var htmlstr = '';
            for(var i=0; i<caption.length;i++)
            {
              if(defaultAudioLanguage==caption[i][0]){
                htmlstr=htmlstr+`<option value="${caption[i][0]}" selected>${caption[i][1]}</option>`
              }
              else
              {
                htmlstr=htmlstr+`<option value="${caption[i][0]}">${caption[i][1]}</option>`
              }
            }
            $('#VideoCaptions').html(`<select class='language' name='lang'>${htmlstr}</select>`)
  
          });          
        });

        $('#youtubeID').val(youtubeVideoId);
        }, 100);
      });

    $('#youtubeurl').keypress(function (e) {
    var key = e.which;
    //console.log(e)
    if(key == 13)  // the enter key code
    {
    $('#youtubeurl').click();
    }
    });
    })
  script.
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-100905207-1', 'auto');
    ga('send', 'pageview');
